<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stock Seeds & Gear | Plants vs Brainrot</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif}
  body{
    min-height:100vh;
    background:#f0f4f8;
    color:#333;
    padding:36px 18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:24px;
    overflow-x:hidden;
    position:relative;
  }

  /* Canvas partikel */
  #particle-canvas{
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    z-index:-1;
  }

  header{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .brand{display:flex;flex-direction:column}
  h1{font-size:1.8rem;color:#4caf50;margin-bottom:4px}
  p.lead{color:#555;font-size:0.95rem}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{
    background:#ffffff;
    border:1px solid #ddd;
    color:#333;
    padding:10px 16px;
    border-radius:12px;
    font-weight:600;
    cursor:pointer;
    transition:transform .2s,filter .2s,box-shadow .2s;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
  }
  .btn:hover{
    transform:translateY(-4px) scale(1.03);
    filter:brightness(1.05);
    box-shadow:0 8px 25px rgba(0,0,0,0.15);
  }
  .timer{font-size:0.95rem;color:#555;margin-top:6px}

  main{width:100%;max-width:1200px}
  .section-title{display:flex;align-items:center;justify-content:space-between;margin:12px 0}
  .section-title h2{font-size:1.3rem;color:#4caf50}

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
    gap:16px;
    perspective: 1000px;
  }

  .card{
    background:#ffffff;
    border-radius:18px;
    padding:20px;
    border:1px solid #eee;
    box-shadow:0 10px 20px rgba(0,0,0,0.08);
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap:12px;
    transition:transform .3s,box-shadow .3s;
    opacity:0;
    animation: fadeInUp 0.6s forwards;
  }
  .card:hover{
    transform:translateY(-12px) rotateX(6deg) rotateY(3deg) scale(1.05);
    box-shadow:0 25px 60px rgba(0,0,0,0.15);
  }

  .emoji-box{
    width:60px;
    height:60px;
    background: #f0f4f8;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:2.5rem;
    animation: bounce 1.5s infinite alternate;
    border:1px solid #ddd;
  }

  .name{font-weight:700;font-size:1rem;color:#333;animation: fadeInUp .8s ease;}
  .qty{font-weight:600;color:#555;font-size:0.95rem;animation: fadeInUp .8s ease .2s}

  .empty{color:#888; padding:20px;text-align:center}

  footer{color:#888;font-size:0.85rem;margin-top:20px}

  /* Skeleton shimmer */
  .skeleton{
    height:12px;
    width:80%;
    background: linear-gradient(90deg,#e0e0e0,#f5f5f5,#e0e0e0);
    border-radius:6px;
    opacity:.9;
    background-size:200% 100%;
    animation: shimmer 1.5s infinite;
  }
  @keyframes shimmer{
    0%{background-position:-200% 0}
    100%{background-position:200% 0}
  }

  @keyframes bounce{0%{transform: translateY(0)}100%{transform: translateY(-10px)}}
  @keyframes fadeInUp{0%{opacity:0; transform:translateY(10px)}100%{opacity:1; transform:translateY(0)}}

  @media (max-width:480px){
    header{flex-direction:column;align-items:flex-start;gap:8px}
    .controls{width:100%;justify-content:space-between}
    .emoji-box{width:50px;height:50px;font-size:2rem;}
  }
</style>
</head>
<body>
<canvas id="particle-canvas"></canvas>

<header>
  <div class="brand">
    <h1>üå± Stock Seeds & Gear</h1>
    <p class="lead">Data otomatis diperbarui setiap 2 detik</p>
    <div class="timer" id="timer">Auto refresh setiap 2 detik</div>
  </div>

  <div class="controls">
    <button class="btn" id="refreshNow">üîÑ Refresh Now</button>
    <a class="btn" href="/" id="backHome">‚¨Ö Kembali ke Beranda</a>
  </div>
</header>

<main>
  <section>
    <div class="section-title"><h2>Seeds</h2></div>
    <div id="seedsGrid" class="grid" data-parallax>
      <div class="card loading"><div class="skeleton"></div></div>
      <div class="card loading"><div class="skeleton"></div></div>
      <div class="card loading"><div class="skeleton"></div></div>
    </div>
  </section>

  <section style="margin-top:18px;">
    <div class="section-title"><h2>Gear</h2></div>
    <div id="gearGrid" class="grid" data-parallax>
      <div class="card loading"><div class="skeleton"></div></div>
      <div class="card loading"><div class="skeleton"></div></div>
    </div>
  </section>

  <div id="statusMsg" style="margin-top:14px;color:#f55;"></div>
</main>

<footer>¬© 2025 Plants vs Brainrot ‚Ä¢ Pasha</footer>

<script>
const API_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://plantsvsbrainrot.com/api/seed-shop.php");

const seedsGrid = document.getElementById('seedsGrid');
const gearGrid = document.getElementById('gearGrid');
const timerEl = document.getElementById('timer');
const statusMsg = document.getElementById('statusMsg');
const refreshNowBtn = document.getElementById('refreshNow');
let countdownTimer = null;

function escapeHtml(s){
  return String(s)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}

function makeCard(item){
  const div = document.createElement('div');
  div.className = 'card';
  div.innerHTML = `
    <div class="emoji-box">${item.emoji || '‚ùî'}</div>
    <div class="name">${escapeHtml(item.name)}</div>
    <div class="qty">Qty: ${Number(item.qty)}</div>
  `;
  return div;
}

function render(data){
  seedsGrid.innerHTML = '';
  gearGrid.innerHTML = '';

  if(Array.isArray(data.seeds) && data.seeds.length){
    data.seeds.forEach(s => seedsGrid.appendChild(makeCard(s)));
  } else {
    seedsGrid.innerHTML = '<div class="empty card">Tidak ada data seeds</div>';
  }

  if(Array.isArray(data.gear) && data.gear.length){
    data.gear.forEach(g => gearGrid.appendChild(makeCard(g)));
  } else {
    gearGrid.innerHTML = '<div class="empty card">Tidak ada data gear</div>';
  }

  if(data.reportedAt) {
    const reported = new Date(Number(data.reportedAt));
    statusMsg.style.color = '#4caf50';
    statusMsg.textContent = 'Last reported: ' + reported.toLocaleString();
  } else {
    statusMsg.textContent = '';
  }
}

async function fetchData() {
  try {
    const res = await fetch(API_URL, { cache: "no-store" });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    render(data);
  } catch (err) {
    console.error(err);
    statusMsg.style.color = '#f55';
    statusMsg.textContent = '‚ö†Ô∏è Gagal memuat data: ' + err.message;
    seedsGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat seeds</div>';
    gearGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat gear</div>';
  }
}

function startAutoRefresh() {
  if (countdownTimer) clearInterval(countdownTimer);
  fetchData();
  countdownTimer = setInterval(fetchData, 2000);
  timerEl.textContent = "Auto refresh setiap 2 detik";
}

refreshNowBtn.addEventListener('click', fetchData);
startAutoRefresh();
window.addEventListener('beforeunload', () => {
  if (countdownTimer) clearInterval(countdownTimer);
});

// Parallax effect
function parallaxScroll(){
  document.querySelectorAll('.grid[data-parallax]').forEach(grid=>{
    const cards = grid.querySelectorAll('.card');
    const rect = grid.getBoundingClientRect();
    const offset = rect.top - window.innerHeight/1.5;
    cards.forEach((card,i)=>{
      const factor = 5 * (i+1);
      card.style.transform = `translateY(${offset/factor}px)`;
    });
  });
}
window.addEventListener('scroll', parallaxScroll);
window.addEventListener('load', parallaxScroll);

// Particle background
const canvas = document.getElementById('particle-canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
for(let i=0;i<120;i++){
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2+1,
    dx: (Math.random()-0.5)*0.5,
    dy: (Math.random()-0.5)*0.5,
    alpha: Math.random()*0.5+0.2
  });
}

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x += p.dx;
    p.y += p.dy;
    if(p.x>canvas.width) p.x=0;
    if(p.x<0) p.x=canvas.width;
    if(p.y>canvas.height) p.y=0;
    if(p.y<0) p.y=canvas.height;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle = `rgba(76,175,80,${p.alpha})`;
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();

window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
