<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stock Seeds & Gear | Plants vs Brainrot</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif}
    body{
      min-height:100vh;
      background: linear-gradient(135deg,#071021,#0f1f2b);
      color:#e9f8ec;
      padding:36px 18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
    }

    header{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;flex-direction:column}
    h1{font-size:1.6rem;color:#9ff77f;margin-bottom:4px}
    p.lead{color:#bcdfb4;font-size:0.95rem}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;padding:10px 16px;border-radius:12px;font-weight:600;cursor:pointer;
      transition:transform .2s,filter .2s,box-shadow .2s;
      backdrop-filter: blur(4px);
    }
    .btn:hover{
      transform:translateY(-4px) scale(1.03);
      filter:brightness(1.12);
      box-shadow:0 6px 20px rgba(0,255,127,0.3);
    }
    .timer{font-size:0.95rem;color:#d7f5d2; margin-top:6px}

    main{width:100%;max-width:1200px}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin:12px 0}
    .section-title h2{font-size:1.2rem;color:#e6ffdd}

    .grid{
      display:flex;
      flex-direction:column; /* vertical */
      gap:16px;
    }

    .card{
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:18px;
      padding:20px;
      border:1px solid rgba(255,255,255,0.05);
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:10px;
      transition:transform .3s,box-shadow .3s;
    }
    .card:hover{
      transform:translateY(-8px) scale(1.02);
      box-shadow:0 20px 50px rgba(0,255,127,0.4);
    }

    .emoji-box{
      width:60px;
      height:60px;
      background:rgba(0,0,0,0.15);
      border-radius:50%;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:2.5rem;
      animation: bounce 1.5s infinite alternate;
      border:1px solid rgba(255,255,255,0.05);
    }

    .name{font-weight:700;font-size:1rem;color:#c6ffc2;animation: fadeInUp .8s ease;}
    .qty{font-weight:600;color:#d7f5d2;font-size:0.95rem;animation: fadeInUp .8s ease .2s}

    .empty{color:#b0c5ad; padding:20px;text-align:center}

    .meta{display:flex;gap:8px;align-items:center;font-size:0.9rem;color:#bcdfb4;margin-top:8px;}
    footer{color:#9fbf9a;font-size:0.85rem;margin-top:20px}

    .skeleton{height:12px;width:80%;background:linear-gradient(90deg,#233a2e,#1b2c23,#233a2e);border-radius:6px;opacity:.9}
    @keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}
    .loading .skeleton{animation:pulse 1.2s infinite ease-in-out}

    @keyframes bounce{
      0%{transform: translateY(0)}
      100%{transform: translateY(-8px)}
    }

    @keyframes fadeInUp{
      0%{opacity:0; transform:translateY(10px)}
      100%{opacity:1; transform:translateY(0)}
    }

    @media (max-width:480px){
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .controls{width:100%;justify-content:space-between}
      .emoji-box{width:50px;height:50px;font-size:2rem;}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1>üå± Stock Seeds & Gear</h1>
      <p class="lead">Data otomatis diperbarui setiap 2 detik</p>
      <div class="timer" id="timer">Auto refresh setiap 2 detik</div>
    </div>

    <div class="controls">
      <button class="btn" id="refreshNow">üîÑ Refresh Now</button>
      <a class="btn" href="/" id="backHome">‚¨Ö Kembali ke Beranda</a>
    </div>
  </header>

  <main>
    <section>
      <div class="section-title"><h2>Seeds</h2></div>
      <div id="seedsGrid" class="grid">
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
      </div>
    </section>

    <section style="margin-top:18px;">
      <div class="section-title"><h2>Gear</h2></div>
      <div id="gearGrid" class="grid">
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
      </div>
    </section>

    <div id="statusMsg" style="margin-top:14px;color:#f7d3d3;"></div>
  </main>

  <footer>¬© 2025 Plants vs Brainrot ‚Ä¢ Pasha</footer>

  <script>
    const API_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://plantsvsbrainrot.com/api/seed-shop.php");

    const seedsGrid = document.getElementById('seedsGrid');
    const gearGrid = document.getElementById('gearGrid');
    const timerEl = document.getElementById('timer');
    const statusMsg = document.getElementById('statusMsg');
    const refreshNowBtn = document.getElementById('refreshNow');
    let countdownTimer = null;

    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    function makeCard(item){
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <div class="emoji-box">${item.emoji || '‚ùî'}</div>
        <div class="name">${escapeHtml(item.name)}</div>
        <div class="qty">Qty: ${Number(item.qty)}</div>
      `;
      return div;
    }

    function render(data){
      seedsGrid.innerHTML = '';
      gearGrid.innerHTML = '';

      if(Array.isArray(data.seeds) && data.seeds.length){
        data.seeds.forEach(s => seedsGrid.appendChild(makeCard(s)));
      } else {
        seedsGrid.innerHTML = '<div class="empty card">Tidak ada data seeds</div>';
      }

      if(Array.isArray(data.gear) && data.gear.length){
        data.gear.forEach(g => gearGrid.appendChild(makeCard(g)));
      } else {
        gearGrid.innerHTML = '<div class="empty card">Tidak ada data gear</div>';
      }

      if(data.reportedAt) {
        const reported = new Date(Number(data.reportedAt));
        statusMsg.style.color = '#bcdfb4';
        statusMsg.textContent = 'Last reported: ' + reported.toLocaleString();
      } else {
        statusMsg.textContent = '';
      }
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        render(data);
      } catch (err) {
        console.error(err);
        statusMsg.style.color = '#f7d3d3';
        statusMsg.textContent = '‚ö†Ô∏è Gagal memuat data: ' + err.message;
        seedsGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat seeds</div>';
        gearGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat gear</div>';
      }
    }

    function startAutoRefresh() {
      if (countdownTimer) clearInterval(countdownTimer);
      fetchData();
      countdownTimer = setInterval(fetchData, 2000);
      timerEl.textContent = "Auto refresh setiap 2 detik";
    }

    refreshNowBtn.addEventListener('click', fetchData);
    startAutoRefresh();
    window.addEventListener('beforeunload', () => {
      if (countdownTimer) clearInterval(countdownTimer);
    });
  </script>
</body>
</html>
