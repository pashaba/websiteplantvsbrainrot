<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stock Seeds & Gear | Plants vs Brainrot</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif}
    body{
      min-height:100vh;
      background: linear-gradient(135deg,#071021,#0f1f2b);
      color:#e9f8ec;
      padding:36px 18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
    }
    header{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;flex-direction:column}
    h1{font-size:1.4rem;color:#9ff77f}
    p.lead{color:#bcdfb4;font-size:0.95rem}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;
      transition:transform .15s,filter .15s;
    }
    .btn:hover{transform:translateY(-4px);filter:brightness(1.08)}
    .timer{font-size:0.95rem;color:#d7f5d2; margin-top:6px}
    main{width:100%;max-width:1200px}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin:12px 0}
    .section-title h2{font-size:1.05rem;color:#e6ffdd}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 8px 24px rgba(0,0,0,0.45);transition:transform .2s,box-shadow .2s;
      display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.6)}
    .emoji{font-size:2rem}
    .name{font-weight:700}
    .qty{font-weight:600;color:#d7f5d2}
    .empty{color:#b0c5ad; padding:20px;text-align:center}
    .meta{display:flex;gap:8px;align-items:center;font-size:0.9rem;color:#bcdfb4;margin-top:8px;}
    footer{color:#9fbf9a;font-size:0.85rem;margin-top:20px}
    .skeleton{height:12px;width:80%;background:linear-gradient(90deg,#233a2e,#1b2c23,#233a2e);border-radius:6px;opacity:.9}
    @keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}
    .loading .skeleton{animation:pulse 1.2s infinite ease-in-out}
    @media (max-width:480px){
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .controls{width:100%;justify-content:space-between}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1>üå± Stock Seeds & Gear</h1>
      <p class="lead">Data otomatis diperbarui setiap 2 detik</p>
      <div class="timer" id="timer">Auto refresh setiap 2 detik</div>
    </div>

    <div class="controls">
      <button class="btn" id="refreshNow">üîÑ Refresh Now</button>
      <a class="btn" href="/" id="backHome">‚¨Ö Kembali ke Beranda</a>
    </div>
  </header>

  <main>
    <section>
      <div class="section-title"><h2>Seeds</h2></div>
      <div id="seedsGrid" class="grid">
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
      </div>
    </section>

    <section style="margin-top:18px;">
      <div class="section-title"><h2>Gear</h2></div>
      <div id="gearGrid" class="grid">
        <div class="card loading"><div class="skeleton"></div></div>
        <div class="card loading"><div class="skeleton"></div></div>
      </div>
    </section>

    <div id="statusMsg" style="margin-top:14px;color:#f7d3d3;"></div>
  </main>

  <footer>¬© 2025 Plants vs Brainrot ‚Ä¢ Pasha</footer>

  <script>
    // ===== CONFIG =====
    const API_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://plantsvsbrainrot.com/api/seed-shop.php");
    const seedsGrid = document.getElementById('seedsGrid');
    const gearGrid = document.getElementById('gearGrid');
    const timerEl = document.getElementById('timer');
    const statusMsg = document.getElementById('statusMsg');
    const refreshNowBtn = document.getElementById('refreshNow');
    let countdownTimer = null;

    // escape untuk keamanan teks
    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // buat kartu item
    function makeCard(item){
      const div = document.createElement('div');
      div.className = 'card';
      const emoji = item.emoji ? `<div class="emoji">${item.emoji}</div>` : '';
      const name = `<div class="name">${escapeHtml(item.name)}</div>`;
      const qty = `<div class="qty">Qty: ${Number(item.qty)}</div>`;
      div.innerHTML = `${emoji}${name}${qty}`;
      return div;
    }

    // render data dari API
    function render(data){
      seedsGrid.innerHTML = '';
      gearGrid.innerHTML = '';

      if(Array.isArray(data.seeds) && data.seeds.length){
        data.seeds.forEach(s => seedsGrid.appendChild(makeCard(s)));
      } else {
        seedsGrid.innerHTML = '<div class="empty card">Tidak ada data seeds</div>';
      }

      if(Array.isArray(data.gear) && data.gear.length){
        data.gear.forEach(g => gearGrid.appendChild(makeCard(g)));
      } else {
        gearGrid.innerHTML = '<div class="empty card">Tidak ada data gear</div>';
      }

      if(data.reportedAt) {
        const reported = new Date(Number(data.reportedAt));
        statusMsg.style.color = '#bcdfb4';
        statusMsg.textContent = 'Last reported: ' + reported.toLocaleString();
      } else {
        statusMsg.textContent = '';
      }
    }

    // ambil data dari API
    async function fetchData() {
      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        render(data);
      } catch (err) {
        console.error(err);
        statusMsg.style.color = '#f7d3d3';
        statusMsg.textContent = '‚ö†Ô∏è Gagal memuat data: ' + err.message;
        seedsGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat seeds</div>';
        gearGrid.innerHTML = '<div class="empty card">‚ö†Ô∏è Gagal memuat gear</div>';
      }
    }

    // auto refresh tiap 2 detik
    function startAutoRefresh() {
      if (countdownTimer) clearInterval(countdownTimer);
      fetchData();
      countdownTimer = setInterval(fetchData, 10000);
      timerEl.textContent = "Auto refresh setiap 2 detik";
    }

    // tombol manual refresh
    refreshNowBtn.addEventListener('click', fetchData);

    // mulai otomatis
    startAutoRefresh();

    // hentikan interval saat keluar halaman
    window.addEventListener('beforeunload', () => {
      if (countdownTimer) clearInterval(countdownTimer);
    });
  </script>
</body>
</html>
